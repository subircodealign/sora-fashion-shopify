<section class="py-[6rem] bg-white px-16 lg:px-32 xl:px-24">
  <div>
    <div class="flex justify-between items-center mb-[3rem]">
      <h2 class="text-[2.75rem] lg:text-[3rem] leading-[4rem] font-catalina text-primary">
        {{ section.settings.heading }}
      </h2>

      <nav class="space-x-4 lg:space-x-5 xl:space-x-6 text-primary text-[1.15rem] lg:text-[1.25rem] leading-[2rem]">
        {% for block in section.blocks %}
          {% if block.type == 'category_link' %}
            <a href="{{ block.settings.link }}" class="hover:text-gray-900">{{ block.settings.label }}</a>
          {% endif %}
        {% endfor %}
      </nav>
    </div>

    <!-- ✅ Desktop & Tablet View (md and up) -->
    <div class="hidden md:grid grid-cols-1 md:grid-cols-3 xl:grid-cols-4 gap-4 lg:gap-6">
      {%- assign count = 0 -%}

      {%- if section.settings.collection != blank -%}
        {%- assign products = collections[section.settings.collection].products -%}
        {%- for product in products -%}
          {%- assign count = count | plus: 1 -%}
          {%- if count <= 6 -%}
            <div>{% render 'product-cards', product: product %}</div>
          {%- elsif count <= 8 -%}
            <div class="hidden xl:block">{% render 'product-cards', product: product %}</div>
          {%- endif -%}
        {%- endfor -%}
      {%- endif -%}

      {%- if section.settings.product_list != blank -%}
        {%- for product in section.settings.product_list -%}
          {%- assign count = count | plus: 1 -%}
          {%- if count <= 6 -%}
            <div>{% render 'product-cards', product: product %}</div>
          {%- elsif count <= 8 -%}
            <div class="hidden xl:block">{% render 'product-cards', product: product %}</div>
          {%- endif -%}
        {%- endfor -%}
      {%- endif -%}

      {%- for block in section.blocks -%}
        {%- if block.type == 'manual_product' and block.settings.product != blank -%}
          {%- assign manual_product = all_products[block.settings.product] -%}
          {%- if manual_product != blank -%}
            {%- assign count = count | plus: 1 -%}
            {%- if count <= 6 -%}
              <div>{% render 'product-cards', product: manual_product %}</div>
            {%- elsif count <= 8 -%}
              <div class="hidden xl:block">{% render 'product-cards', product: manual_product %}</div>
            {%- endif -%}
          {%- endif -%}
        {%- endif -%}
      {%- endfor -%}
    </div>

    <!-- ✅ Mobile View (below md): Pagination Enabled -->
  <!-- ✅ Mobile View (below md): Pagination Enabled -->
<div class="block md:hidden mt-8">
  {%- assign mobile_products_array = '' -%}
  {%- assign product_count = 0 -%}

  {%- if section.settings.collection != blank -%}
    {%- assign products = collections[section.settings.collection].products -%}
    {%- for product in products limit: 12 -%}
      {%- assign product_data = product | json -%}
      {%- assign mobile_products_array = mobile_products_array | append: product_data -%}
      {%- assign product_count = product_count | plus: 1 -%}
      {%- if forloop.last == false -%}{%- assign mobile_products_array = mobile_products_array | append: ',' -%}{%- endif -%}
    {%- endfor -%}
  {%- elsif section.settings.product_list != blank -%}
    {%- for product in section.settings.product_list -%}
      {%- assign product_data = product | json -%}
      {%- assign mobile_products_array = mobile_products_array | append: product_data -%}
      {%- assign product_count = product_count | plus: 1 -%}
      {%- if forloop.last == false -%}{%- assign mobile_products_array = mobile_products_array | append: ',' -%}{%- endif -%}
    {%- endfor -%}
  {%- endif -%}

  <div id="product-pagination" data-products='[{{ mobile_products_array }}]' data-per-page="4"></div>
  <div id="product-container" class="grid grid-cols-2 gap-4 mt-6"></div>
  <div id="pagination-controls" class="flex flex-wrap justify-center gap-2 mt-6"></div>
</div>

  </div>
</section>

{% schema %}
{
  "name": "Home New Arrivals",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Section Heading",
      "default": "Our New Arrivals"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "Product Collection (optional)"
    },
    {
      "type": "product_list",
      "id": "product_list",
      "label": "Manual Products (optional)",
      "limit": 10
    }
  ],
  "blocks": [
    {
      "type": "category_link",
      "name": "Category Link",
      "settings": [
        {
          "type": "text",
          "id": "label",
          "label": "Link Label",
          "default": "Man"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Link URL"
        }
      ]
    }
  ]
}
{% endschema %}
